jQuery(document).ready(function(a){"use strict";a(window).load(function(){var b=Backbone.View.extend({id:0,project_id:task_breakerProjectSettings.project_id,page:1,priority:-1,current_page:1,max_page:1,min_page:1,total:0,show_completed:"no",total_pages:0}),c=new b,d=Backbone.View.extend({el:"body",model:c,search:"",template:"",events:{"click .task_breaker-project-tab-li-item-a":"switchView","click .next-page":"next","click .prev-page":"prev","click #task_breaker-task-search-submit":"searchTasks","change #task_breaker-task-filter-select":"filter"},switchView:function(b,c){a("#task_breaker-project-edit-tab").css("display","none"),a("#task_breaker-project-add-new").css("display","none"),a(".task_breaker-project-tab-li-item").removeClass("active"),a(".task_breaker-project-tab-content-item").removeClass("active");var d="";if(b){var e=a(b.currentTarget);d=e.attr("data-content"),e.parent().addClass("active"),a("div[data-content="+d+"]").addClass("active")}else a(c).addClass("active"),d=a(c).attr("data-content"),a("a[data-content="+d+"]").parent().addClass("active")},hideFilters:function(){a("#task_breaker-tasks-filter").hide()},showFilters:function(){a("#task_breaker-tasks-filter").show()},searchTasks:function(){var b=a("#task_breaker-task-search-field").val();0===b.length?location.href="#tasks":location.href="#tasks/search/"+encodeURI(b)},filter:function(a){this.model.priority=a.currentTarget.value;var b=Backbone.history.getFragment();"tasks"!=b?location.href="#tasks":this.render()},next:function(a){a.preventDefault();var b=this.model.page;b<this.model.max_page&&(this.model.page=++b,location.href="#tasks/page/"+this.model.page)},prev:function(a){a.preventDefault();var b=this.model.page;b>this.model.min_page&&(this.model.page=--b,location.href="#tasks/page/"+this.model.page)},single:function(b){this.progress(!0);var c=this;this.template="task_breaker_ticket_single",this.renderTask(function(b){c.progress(!1);var d=JSON.parse(b);d.html&&a("#task_breaker-project-tasks").html(d.html)})},showEditForm:function(b){this.progress(!0);var c=this,d=tinymce.get("task_breakerTaskEditDescription");d?d.setContent(""):a("#task_breakerTaskEditDescription").val(""),a(".task_breaker-project-tab-content-item").removeClass("active"),a(".task_breaker-project-tab-li-item").removeClass("active"),a("a#task_breaker-project-edit-tab").css("display","block").parent().addClass("active"),a("#task_breaker-project-edit-context").addClass("active"),a("#task_breakerTaskId").attr("disabled",!0).val("loading..."),a("#task_breakerTaskEditTitle").attr("disabled",!0).val("loading..."),a("#task_breaker-task-edit-select-id").attr("disabled",!0),this.model.id=b,this.renderTask(function(b){c.progress(!1);var d=JSON.parse(b);if(d.task){var e=d.task,f=tinymce.get("task_breakerTaskEditDescription");a("#task_breakerTaskId").val(e.id).removeAttr("disabled"),a("#task_breakerTaskEditTitle").val(e.title).removeAttr("disabled"),f?f.setContent(e.description):a("#task_breakerTaskEditDescription").val(e.description),a("#task_breaker-task-edit-select-id").val(e.priority).change().removeAttr("disabled")}})},renderTask:function(b){a.ajax({url:ajaxurl,method:"get",data:{action:"task_breaker_transactions_request",method:"task_breaker_transaction_fetch_task",id:this.model.id,template:this.template,nonce:task_breakerProjectSettings.nonce},success:function(a){b(a)}})},render:function(){var b=this;this.progress(!0),a.ajax({url:ajaxurl,method:"get",data:{action:"task_breaker_transactions_request",method:"task_breaker_transaction_fetch_task",id:this.model.id,project_id:this.model.project_id,page:this.model.page,search:this.search,priority:this.model.priority,template:"task_breaker_the_tasks",show_completed:this.model.show_completed,nonce:task_breakerProjectSettings.nonce},success:function(d){b.progress(!1);var e=JSON.parse(d);"success"==e.message&&(e.task.stats&&(c.max_page=e.task.stats.max_page,c.min_page=e.task.stats.min_page),a("#task_breaker-project-tasks").html(e.html)),0===e.task.length&&a("#task_breaker-project-tasks").html('<div class="error" id="message"><p>No tasks found. If you\'re trying to find a task, kindly try different keywords and/or filters.</p></div>')},error:function(){}})},initialize:function(){},progress:function(b){var c="none",d=1;b&&(c="block",d=.25),a("#task_breaker-preloader").css({display:c}),a("#task_breaker-project-tasks").css({opacity:d})},updateStats:function(b){var c=b.status.priority,d=b.status.task_status;d&&a("#task-details-status").text(d).removeClass("open close").addClass(d.toLowerCase()),c&&a("#task-details-priority").text(c).removeClass("normal high critical").addClass(c.toLowerCase()),a(".task_breaker-total-tasks").text(b.total),a(".task_breaker-remaining-tasks-count").text(b.remaining),a(".task-progress-completed").text(b.completed),a(".task-progress-percentage-label > span").text(b.progress),a(".task-progress-percentage").css({width:Math.ceil(b.completed/b.total*100)+"%"})}}),e=new d,f=Backbone.Router.extend({routes:{tasks:"index","tasks/dashboard":"dashboard","tasks/settings":"settings","tasks/completed":"completed_tasks","tasks/add":"add","tasks/edit/:id":"edit","tasks/page/:page":"next","tasks/view/:id":"view_task","tasks/search/:search_keyword":"search"},view:e,model:c,index:function(){this.view.switchView(null,"#task_breaker-project-tasks-context"),this.model.page=1,this.model.id=0,this.model.show_completed="no",this.view.search="",this.view.render()},dashboard:function(){this.view.switchView(null,"#task_breaker-project-dashboard-context")},settings:function(){this.view.switchView(null,"#task_breaker-project-settings-context")},add:function(){this.view.switchView(null,"#task_breaker-project-add-new-context"),a("#task_breaker-project-add-new").css("display","block"),tinymce.editors.task_breakerTaskDescription&&tinymce.editors.task_breakerTaskDescription.setContent("")},completed_tasks:function(){this.view.switchView(null,"#task_breaker-project-tasks-context"),this.model.show_completed="yes",this.view.render()},edit:function(b){this.view.showEditForm(b),a("#task_breaker-edit-task-message").html("")},next:function(a){this.model.page=a,this.view.render()},view_task:function(a){this.model.id=a,this.view.single(a),this.view.switchView(null,"#task_breaker-project-tasks-context")},search:function(a){this.model.page=1,this.model.id=0,this.view.search=a,this.view.render()}}),g=new f;g.on("route",function(a){"view_task"===a?this.view.hideFilters():this.view.showFilters()}),Backbone.history.start(),a("#task_breaker-submit-btn").click(function(b){b.preventDefault();var c=a(this);c.attr("disabled",!0),c.text("Loading ...");var d="",f=tinymce.get("task_breakerTaskDescription");d=f?f.getContent():a("#task_breakerTaskDescription").val(),a.ajax({url:ajaxurl,data:{action:"task_breaker_transactions_request",method:"task_breaker_transaction_add_ticket",description:d,title:a("#task_breakerTaskTitle").val(),milestone_id:a("#task_breakerTaskMilestone").val(),priority:a("#task_breaker-task-priority-select").val(),nonce:task_breakerProjectSettings.nonce,project_id:task_breakerTaskConfig.currentProjectId,user_id:task_breakerTaskConfig.currentUserId},method:"post",success:function(b){parseInt(a(".task_breaker-total-tasks").text().trim()),parseInt(a(".task_breaker-remaining-tasks-count").text().trim());b=JSON.parse(b),"success"===b.message?(c.text("Save Task"),c.removeAttr("disabled"),a("#task_breakerTaskDescription").val(""),a("#task_breakerTaskTitle").val(""),e.updateStats(b.stats),location.href="#tasks/view/"+b.response.id):(a("#task_breaker-add-task-message").html('<p class="error">'+b.response+"</p>").show().addClass("error"),c.text("Save Task"),c.removeAttr("disabled"))},error:function(){}})}),a("#task_breaker-edit-btn").click(function(b){b.preventDefault();var c=a(this);c.attr("disabled",!0),c.text("Loading ...");var d="",e=tinymce.get("task_breakerTaskEditDescription");d=e?e.getContent():a("#task_breakerTaskEditDescription").val(),a.ajax({url:ajaxurl,data:{description:d,nonce:task_breakerProjectSettings.nonce,project_id:task_breakerTaskConfig.currentProjectId,user_id:task_breakerTaskConfig.currentUserId,action:"task_breaker_transactions_request",method:"task_breaker_transaction_edit_ticket",title:a("#task_breakerTaskEditTitle").val(),milestone_id:a("#task_breakerTaskMilestone").val(),id:a("#task_breakerTaskId").val(),priority:a('select[name="task_breaker-task-edit-priority"]').val()},method:"post",success:function(b){var d=JSON.parse(b),e="<p class='success'>Task successfully updated <a href='#tasks/view/"+d.id+"'>&#65515; View</a></p>";"fail"===d.message&&"no_changes"!==d.type&&(e="<p class='error'>There was an error updating the task. All fields are required.</a></p>"),a("#task_breaker-edit-task-message").html(e).show(),c.attr("disabled",!1),c.text("Update Task")},error:function(){console.log("An Error Occured [task_breaker.js]#311")}})}),a("body").on("click","#task_breaker-delete-btn",function(){var b=confirm("Are you sure you want to delete this task? This action is irreversible");if(b){var d=a(this),f=parseInt(c.id),g=parseInt(c.project_id),h={action:"task_breaker_transactions_request",method:"task_breaker_transaction_delete_ticket",id:f,project_id:g,nonce:task_breakerProjectSettings.nonce};e.progress(!0),d.text("Deleting ..."),a.ajax({url:ajaxurl,data:h,method:"post",success:function(a){var b=JSON.parse(a);e.progress(!1),e.updateStats(b.stats),location.href="#tasks",e.switchView(null,"#task_breaker-project-tasks-context"),d.text("Delete")},error:function(){e.progress(!1),location.href="#tasks",e.switchView(null,"#task_breaker-project-tasks-context"),d.text("Delete")}})}}),a("body").on("click","#updateTaskBtn",function(){var b=c.id,d=a("#task-comment-content").val(),f=a("#task_breaker-task-priority-update-select").val(),g=a("input[name=task_commment_completed]:checked").val(),h=parseInt(c.project_id);if(0!==b&&0!==d.length){e.progress(!0);var i={action:"task_breaker_transactions_request",method:"task_breaker_transaction_add_comment_to_ticket",ticket_id:b,priority:f,details:d,completed:g,project_id:h,nonce:task_breakerProjectSettings.nonce};a.ajax({url:ajaxurl,data:i,method:"post",success:function(b){var c=JSON.parse(b);e.progress(!1),a("#task-comment-content").val(""),a("#task-lists").append(c.result),"yes"===g&&(a("#ticketStatusInProgress").attr("disabled",!0).attr("checked",!1),a("#ticketStatusComplete").attr("disabled",!0).attr("checked",!1),a("#comment-completed-radio").addClass("hide"),a("#ticketStatusCompleteUpdate").attr("disabled",!1).attr("checked",!0),a("#ticketStatusReOpenUpdate").attr("disabled",!1),a("#task_breaker-comment-completed-radio").removeClass("hide")),"reopen"===g&&(a("#ticketStatusInProgress").attr("disabled",!1).attr("checked",!0),a("#ticketStatusComplete").attr("disabled",!1).attr("checked",!1),a("#comment-completed-radio").removeClass("hide"),a("#ticketStatusCompleteUpdate").attr("disabled",!0).attr("checked",!1),a("#ticketStatusReOpenUpdate").attr("disabled",!0),a("#task_breaker-comment-completed-radio").addClass("hide")),e.updateStats(c.stats)},error:function(){e.progress(!1)}})}}),a("body").on("click","a.task_breaker-delete-comment",function(b){b.preventDefault();var c=confirm("Are you sure you want to delete this comment? This action is irreversible. ");if(!c)return!1;var d=a(this),f=parseInt(a(this).attr("data-comment-id")),g={action:"task_breaker_transactions_request",method:"task_breaker_transaction_delete_comment",comment_id:f,nonce:task_breakerProjectSettings.nonce};e.progress(!0),a.ajax({url:ajaxurl,data:g,method:"post",success:function(b){e.progress(!1);var c=JSON.parse(b);"success"==c.message?d.parent().parent().parent().parent().fadeOut(function(){a(this).remove()}):this.error()},error:function(){e.progress(!1),d.parent().append('<p class="error">Transaction Error: There was an error trying to delete this comment.</p>')}})}),a("body").on("click","#task_breakerUpdateProjectBtn",function(){var b=a(this),c="",d=tinymce.get("task_breakerProjectContent");c=d?d.getContent():a("#task_breakerProjectContent").val();var f={action:"task_breaker_transactions_request",method:"task_breaker_transactions_update_project",id:parseInt(a("#task_breaker-project-id").val()),title:a("#task_breaker-project-name").val(),content:c,group_id:parseInt(a("select[name=task_breaker-project-assigned-group]").val()),nonce:task_breakerProjectSettings.nonce};b.attr("disabled",!0).text("Updating ..."),e.progress(!0),a(".task_breaker-project-updated").remove(),a.ajax({url:ajaxurl,data:f,method:"post",success:function(c){var d=JSON.parse(c);e.progress(!1),b.attr("disabled",!1).text("Update Project"),"success"===d.message?(a("article .entry-header > .entry-title").text(a("#task_breaker-project-name").val()),b.parent().parent().prepend('<div id="message" class="task_breaker-project-updated success updated"><p>Project details successfully updated.</p></div>')):b.parent().parent().prepend('<div id="message" class="task_breaker-project-updated success updated"><p>There was an error saving the project. All fields are required.</p></div>'),e.progress(!1),setTimeout(function(){a(".task_breaker-project-updated").fadeOut()},3e3)},error:function(){alert("connection failure")}})}),a("body").on("click","#task_breakerDeleteProjectBtn",function(){if(confirm("Are you sure you want to delete this project? All the tickets under this project will be deleted as well. This action cannot be undone.")){var b=a("#task_breaker-project-id").val(),c={action:"task_breaker_transactions_request",method:"task_breaker_transactions_delete_project",id:b,nonce:task_breakerProjectSettings.nonce};a(this).text("Deleting..."),a.ajax({url:ajaxurl,method:"post",data:c,success:function(a){var b=JSON.parse(a);"success"==b.message?window.location=b.redirect:(console.log("__success_callback"),this.error())},error:function(){alert("There was an error trying to delete this post. Try again later.")}})}})})});
//# sourceMappingURL=task-breaker.min.js.map